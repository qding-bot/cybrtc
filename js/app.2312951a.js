(function(e){function t(t){for(var n,a,r=t[0],c=t[1],d=t[2],h=0,u=[];h<r.length;h++)a=r[h],s[a]&&u.push(s[a][0]),s[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);l&&l(t);while(u.length)u.shift()();return i.push.apply(i,d||[]),o()}function o(){for(var e,t=0;t<i.length;t++){for(var o=i[t],n=!0,r=1;r<o.length;r++){var c=o[r];0!==s[c]&&(n=!1)}n&&(i.splice(t--,1),e=a(a.s=o[0]))}return e}var n={},s={app:0},i=[];function a(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=n,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(o,n,function(t){return e[t]}.bind(null,n));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/cybrtc/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var d=0;d<r.length;d++)t(r[d]);var l=c;i.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"034f":function(e,t,o){"use strict";var n=o("64a9"),s=o.n(n);s.a},"56d7":function(e,t,o){"use strict";o.r(t);o("cadf"),o("551c"),o("f751"),o("097d");var n=o("2b0e"),s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("VideoFrame")],1)},i=[],a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"videos"}},[o("video",{attrs:{id:"localVideo",autoplay:"",muted:"",playsinline:""},domProps:{srcObject:e.localStream,muted:!0}}),o("video",{attrs:{id:"remoteVideo",autoplay:"",playsinline:""},domProps:{srcObject:e.remoteStream}})])},r=[],c=(o("7f7f"),o("6b54"),o("06db"),o("f499")),d=o.n(c),l={name:"VideoFrame",data:function(){return{room:void 0,isStarted:!1,isInitiator:!1,isChannelReady:!1,turnReady:!1,pc:void 0,pcConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},localStream:void 0,remoteStream:void 0}},methods:{sendMessage:function(e){console.log("Client sending message: ",e),this.$socket.send(d()({action:"message",message:e,room:this.room}))},onOpen:function(){console.log("CONNECTED"),""!==this.room&&(this.$socket.send(d()({action:"create or join",room:this.room})),console.log("Attempted to create or join room",this.room))},onClose:function(){console.log("CLOSED")},onMessage:function(e){var t=JSON.parse(e.data);switch(t.action){case"created":var o=t.room;console.log("Created room "+o),this.isInitiator=!0;break;case"full":var n=t.room;alert("Room "+n+" is full");break;case"join":var s=t.room;console.log("Another peer made a request to join room "+s),console.log("This peer is the initiator of room "+s+"!"),this.isChannelReady=!0;break;case"joined":var i=t.room;console.log("joined: "+i),this.isChannelReady=!0;break;case"message":var a=t.message;if(console.log("Client received message:",a),"got user media"===a)this.maybeStart();else if("bye"===a&&this.isStarted)this.handleRemoteHangup();else switch(a.type){case"offer":this.isInitiator||this.isStarted||this.maybeStart(),this.pc.setRemoteDescription(new RTCSessionDescription(a)),this.doAnswer();break;case"answer":this.isStarted&&this.pc.setRemoteDescription(new RTCSessionDescription(a));break;case"candidate":if(this.isStarted){var r=new RTCIceCandidate({sdpMLineIndex:a.label,candidate:a.candidate});this.pc.addIceCandidate(r)}break}break}},onError:function(e){console.log("ERROR",e.data)},gotStream:function(e){console.log("Adding local stream."),this.localStream=e,this.sendMessage("got user media"),this.isInitiator&&this.maybeStart()},maybeStart:function(){console.log(">>>>>>> maybeStart() ",this.isStarted,this.localStream,this.isChannelReady),!this.isStarted&&void 0!==this.localStream&&this.isChannelReady?(console.log(">>>>>> creating peer connection"),this.createPeerConnection(),this.pc.addStream(this.localStream),this.isStarted=!0,console.log("isInitiator",this.isInitiator),this.isInitiator&&this.doCall()):console.log("not start")},createPeerConnection:function(){try{this.pc=new RTCPeerConnection(null),this.pc.onicecandidate=this.handleIceCandidate,this.pc.onaddstream=this.handleRemoteStreamAdded,this.pc.onremovestream=this.handleRemoteStreamRemoved,console.log("Created RTCPeerConnnection")}catch(e){console.log("Failed to create PeerConnection, exception: "+e.message),alert("Cannot create RTCPeerConnection object.")}},doCall:function(){console.log("Sending offer to peer"),this.pc.createOffer(this.setLocalAndSendMessage,this.handleCreateOfferError)},doAnswer:function(){console.log("Sending answer to peer."),this.pc.createAnswer(this.setLocalAndSendMessage,this.onCreateSessionDescriptionError)},handleIceCandidate:function(e){console.log("icecandidate event: ",e),e.candidate?this.sendMessage({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):console.log("End of candidates.")},handleRemoteStreamAdded:function(e){console.log("Remote stream added."),this.remoteStream=e.stream},handleRemoteStreamRemoved:function(e){console.log("Remote stream removed. Event: ",e)},setLocalAndSendMessage:function(e){this.pc.setLocalDescription(e),console.log("setLocalAndSendMessage sending message",e),this.sendMessage(e)},handleCreateOfferError:function(e){console.log("createOffer() error: ",e)},onCreateSessionDescriptionError:function(e){console.trace("Failed to create session description: "+e.toString())},handleRemoteHangup:function(){console.log("Session terminated."),this.stop(),this.isInitiator=!1},stop:function(){this.isStarted=!1,this.pc.close(),this.pc=null}},created:function(){var e=this;window.addEventListener("beforeunload",function(){e.sendMessage("bye")})},mounted:function(){this.room=prompt("Enter room name:"),this.$options.sockets.onopen=this.onOpen,this.$options.sockets.onclose=this.onClose,this.$options.sockets.onmessage=this.onMessage,this.$options.sockets.onerror=this.onError,navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(this.gotStream).catch(function(e){alert("getUserMedia() error: "+e.name)})}},h=l,u=o("2877"),m=Object(u["a"])(h,a,r,!1,null,null,null),p=m.exports,f={name:"app",components:{VideoFrame:p}},g=f,v=(o("034f"),Object(u["a"])(g,s,i,!1,null,null,null)),S=v.exports,b=o("b408"),C=o.n(b);n["a"].config.productionTip=!1,n["a"].use(C.a,"wss://gbgeujsgda.execute-api.us-east-1.amazonaws.com/test",{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:3e3}),new n["a"]({render:function(e){return e(S)}}).$mount("#app")},"64a9":function(e,t,o){}});
//# sourceMappingURL=app.2312951a.js.map