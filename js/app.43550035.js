(function(e){function t(t){for(var n,i,a=t[0],c=t[1],d=t[2],u=0,h=[];u<a.length;u++)i=a[u],s[i]&&h.push(s[i][0]),s[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);l&&l(t);while(h.length)h.shift()();return r.push.apply(r,d||[]),o()}function o(){for(var e,t=0;t<r.length;t++){for(var o=r[t],n=!0,a=1;a<o.length;a++){var c=o[a];0!==s[c]&&(n=!1)}n&&(r.splice(t--,1),e=i(i.s=o[0]))}return e}var n={},s={app:0},r=[];function i(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=n,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/cybrtc/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],c=a.push.bind(a);a.push=t,a=a.slice();for(var d=0;d<a.length;d++)t(a[d]);var l=c;r.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"034f":function(e,t,o){"use strict";var n=o("64a9"),s=o.n(n);s.a},"56d7":function(e,t,o){"use strict";o.r(t);o("cadf"),o("551c"),o("f751"),o("097d");var n=o("2b0e"),s=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("VideoFrame")],1)},r=[],i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"videos"}},[o("video",{attrs:{id:"localVideo",autoplay:"",muted:"",playsinline:""},domProps:{srcObject:e.localStream,muted:!0}}),o("video",{attrs:{id:"remoteVideo",autoplay:"",playsinline:""},domProps:{srcObject:e.remoteStream}})])},a=[],c=(o("7f7f"),o("6b54"),o("06db"),o("f499")),d=o.n(c),l={name:"VideoFrame",props:{msg:String},data:function(){return{room:void 0,isStarted:!1,isInitiator:!1,isChannelReady:!1,turnReady:!1,pc:void 0,pcConfig:{iceServers:[{urls:"stun:stun.l.google.com:19302"}]},localStream:void 0,remoteStream:void 0}},methods:{sendMessage:function(e){console.log("Client sending message: ",e),this.$socket.send(d()({action:"message",message:e,room:this.room}))},maybeStart:function(){console.log(">>>>>>> maybeStart() ",this.isStarted,this.localStream,this.isChannelReady),!this.isStarted&&"undefined"!==typeof this.localStream&&this.isChannelReady&&(console.log(">>>>>> creating peer connection"),this.createPeerConnection(),this.pc.addStream(this.localStream),this.isStarted=!0,console.log("isInitiator",this.isInitiator),this.isInitiator&&this.doCall())},createPeerConnection:function(){try{this.pc=new RTCPeerConnection(null),this.pc.onicecandidate=this.handleIceCandidate,this.pc.onaddstream=this.handleRemoteStreamAdded,this.pc.onremovestream=this.handleRemoteStreamRemoved,console.log("Created RTCPeerConnnection")}catch(e){console.log("Failed to create PeerConnection, exception: "+e.message),alert("Cannot create RTCPeerConnection object.")}},handleIceCandidate:function(e){console.log("icecandidate event: ",e),e.candidate?this.sendMessage({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):console.log("End of candidates.")},setLocalAndSendMessage:function(e){this.pc.setLocalDescription(e),console.log("setLocalAndSendMessage sending message",e),this.sendMessage(e)},handleCreateOfferError:function(e){console.log("createOffer() error: ",e)},doCall:function(){console.log("Sending offer to peer"),this.pc.createOffer(this.setLocalAndSendMessage,this.handleCreateOfferError)},onCreateSessionDescriptionError:function(e){console.trace("Failed to create session description: "+e.toString())},requestTurn:function(e){var t=!1;for(var o in this.pcConfig.iceServers)if("turn:"===this.pcConfig.iceServers[o].urls.substr(0,5)){t=!0,this.turnReady=!0;break}if(!t){console.log("Getting TURN server from ",e);var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var e=JSON.parse(n.responseText);console.log("Got TURN server: ",e),this.pcConfig.iceServers.push({urls:"turn:"+e.username+"@"+e.turn,credential:e.password}),this.turnReady=!0}},n.open("GET",e,!0),n.send()}},handleRemoteStreamAdded:function(e){console.log("Remote stream added."),this.remoteStream=e.stream},handleRemoteStreamRemoved:function(e){console.log("Remote stream removed. Event: ",e)},handleRemoteHangup:function(){console.log("Session terminated."),stop(),this.isInitiator=!1},stop:function(){this.isStarted=!1,this.pc.close(),this.pc=null},doAnswer:function(){console.log("Sending answer to peer."),this.pc.createAnswer().then(this.setLocalAndSendMessage,this.onCreateSessionDescriptionError)},gotStream:function(e){console.log("Adding local stream."),this.localStream=e,this.sendMessage("got user media"),this.isInitiator&&this.maybeStart()},onOpen:function(){console.log("CONNECTED"),""!==this.room&&(this.$socket.send(d()({action:"create or join",room:this.room})),console.log("Attempted to create or join room",this.room))},onClose:function(){console.log("CLOSED")},onMessage:function(e){var t=JSON.parse(e.data);switch(t.action){case"created":var o=t.room;console.log("Created room "+o),this.isInitiator=!0;break;case"full":var n=t.room;alert("Room "+n+" is full");break;case"join":var s=t.room;console.log("Another peer made a request to join room "+s),console.log("This peer is the initiator of room "+s+"!"),this.isChannelReady=!0;break;case"joined":var r=t.room;console.log("joined: "+r),this.isChannelReady=!0;break;case"message":var i=t.message;if(console.log("Client received message:",i),"got user media"===i)this.maybeStart();else if("bye"===i&&this.isStarted)this.handleRemoteHangup();else switch(i.type){case"offer":this.isInitiator||this.isStarted||this.maybeStart(),this.pc.setRemoteDescription(new RTCSessionDescription(i)),this.doAnswer();break;case"answer":this.isStarted&&this.pc.setRemoteDescription(new RTCSessionDescription(i));break;case"candidate":if(this.isStarted){var a=new RTCIceCandidate({sdpMLineIndex:i.label,candidate:i.candidate});this.pc.addIceCandidate(a)}break}break}},onError:function(e){console.log("ERROR",e.data)}},mounted:function(){this.room=prompt("Enter room name:"),this.$options.sockets.onopen=this.onOpen,this.$options.sockets.onclose=this.onClose,this.$options.sockets.onmessage=this.onMessage,this.$options.sockets.onerror=this.onError,navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(this.gotStream).catch(function(e){alert("getUserMedia() error: "+e.name)})}},u=l,h=o("2877"),p=Object(h["a"])(u,i,a,!1,null,null,null),m=p.exports,f={name:"app",components:{VideoFrame:m}},g=f,v=(o("034f"),Object(h["a"])(g,s,r,!1,null,null,null)),S=v.exports,b=o("b408"),y=o.n(b);n["a"].config.productionTip=!1,n["a"].use(y.a,"wss://gbgeujsgda.execute-api.us-east-1.amazonaws.com/test",{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:3e3}),new n["a"]({render:function(e){return e(S)}}).$mount("#app")},"64a9":function(e,t,o){}});
//# sourceMappingURL=app.43550035.js.map