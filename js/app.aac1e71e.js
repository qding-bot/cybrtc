(function(e){function t(t){for(var n,a,i=t[0],c=t[1],l=t[2],u=0,h=[];u<i.length;u++)a=i[u],r[a]&&h.push(r[a][0]),r[a]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);d&&d(t);while(h.length)h.shift()();return s.push.apply(s,l||[]),o()}function o(){for(var e,t=0;t<s.length;t++){for(var o=s[t],n=!0,i=1;i<o.length;i++){var c=o[i];0!==r[c]&&(n=!1)}n&&(s.splice(t--,1),e=a(a.s=o[0]))}return e}var n={},r={app:0},s=[];function a(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=n,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(o,n,function(t){return e[t]}.bind(null,n));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/cybrtc/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var d=c;s.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"034f":function(e,t,o){"use strict";var n=o("64a9"),r=o.n(n);r.a},"56d7":function(e,t,o){"use strict";o.r(t);o("cadf"),o("551c"),o("f751"),o("097d");var n=o("2b0e"),r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"app"}},[o("VideoFrame")],1)},s=[],a=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"videos"}},[o("video",{attrs:{id:"localVideo",autoplay:"",muted:"",playsinline:""},domProps:{srcObject:e.localStream,muted:!0}}),o("video",{attrs:{id:"remoteVideo",autoplay:"",playsinline:""},domProps:{srcObject:e.remoteStream}})])},i=[],c=(o("7f7f"),o("6b54"),o("06db"),o("f499")),l=o.n(c),d=(o("f559"),o("5d73")),u=o.n(d),h={name:"VideoFrame",data:function(){return{room:void 0,isStarted:!1,isInitiator:!1,isChannelReady:!1,turnReady:!1,pc:void 0,pcConfig:{iceServers:[{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},localStream:void 0,remoteStream:void 0}},methods:{requestServers:function(e){var t=this,o=!1,n=!0,r=!1,s=void 0;try{for(var a,i=u()(this.pcConfig.iceServers);!(n=(a=i.next()).done);n=!0){var c=a.value;if(c.urls.startsWith("turn:")){o=!0,this.turnReady=!0;break}}}catch(d){r=!0,s=d}finally{try{n||null==i.return||i.return()}finally{if(r)throw s}}if(!o){var l=new XMLHttpRequest;l.onreadystatechange=function(){if(4===l.readyState&&200===l.status){var e=JSON.parse(l.responseText),o=!0,n=!1,r=void 0;try{for(var s,a=u()(e.iceServers);!(o=(s=a.next()).done);o=!0){var i=s.value;i.url.startsWith("turn:")&&(console.log("Got TURN server: ",i.url),t.pcConfig.iceServers.push({urls:"turn:"+i.username+"@"+i.url,credential:i.credential}))}}catch(d){n=!0,r=d}finally{try{o||null==a.return||a.return()}finally{if(n)throw r}}t.turnReady=!0}},l.open("GET",e,!0),l.send()}},sendMessage:function(e){console.log("Client sending message: ",e),this.$socket.send(l()({action:"message",message:e,room:this.room}))},onOpen:function(){console.log("CONNECTED"),""!==this.room&&(this.$socket.send(l()({action:"create or join",room:this.room})),console.log("Attempted to create or join room",this.room))},onClose:function(){console.log("CLOSED")},onMessage:function(e){var t=JSON.parse(e.data);switch(t.action){case"created":var o=t.room;console.log("Created room "+o),this.isInitiator=!0;break;case"full":var n=t.room;alert("Room "+n+" is full");break;case"join":var r=t.room;console.log("Another peer made a request to join room "+r),console.log("This peer is the initiator of room "+r+"!"),this.isChannelReady=!0;break;case"joined":var s=t.room;console.log("joined: "+s),this.isChannelReady=!0;break;case"message":var a=t.message;if(console.log("Client received message:",a),"got user media"===a)this.maybeStart();else if("bye"===a&&this.isStarted)this.handleRemoteHangup();else switch(a.type){case"offer":this.isInitiator||this.isStarted||this.maybeStart(),this.pc.setRemoteDescription(new RTCSessionDescription(a)),this.doAnswer();break;case"answer":this.isStarted&&this.pc.setRemoteDescription(new RTCSessionDescription(a));break;case"candidate":if(this.isStarted){var i=new RTCIceCandidate({sdpMLineIndex:a.label,candidate:a.candidate});this.pc.addIceCandidate(i)}break}break}},onError:function(e){console.log("ERROR",e.data)},gotStream:function(e){console.log("Adding local stream."),this.localStream=e,this.sendMessage("got user media"),this.isInitiator&&this.maybeStart()},maybeStart:function(){console.log(">>>>>>> maybeStart() ",this.isStarted,this.localStream,this.isChannelReady),!this.isStarted&&void 0!==this.localStream&&this.isChannelReady?(console.log(">>>>>> creating peer connection"),this.createPeerConnection(),this.pc.addStream(this.localStream),this.isStarted=!0,console.log("isInitiator",this.isInitiator),this.isInitiator&&this.doCall()):(console.log("Started: ".concat(this.isStarted," channelReady: ").concat(this.isChannelReady," localStream: ").concat(this.localStream)),console.log("not start"))},createPeerConnection:function(){try{this.pc=new RTCPeerConnection(null),this.pc.onicecandidate=this.handleIceCandidate,this.pc.onaddstream=this.handleRemoteStreamAdded,this.pc.onremovestream=this.handleRemoteStreamRemoved,console.log("Created RTCPeerConnnection")}catch(e){console.log("Failed to create PeerConnection, exception: "+e.message),alert("Cannot create RTCPeerConnection object.")}},doCall:function(){console.log("Sending offer to peer"),this.pc.createOffer().then(this.setLocalAndSendMessage,this.handleCreateOfferError)},doAnswer:function(){console.log("Sending answer to peer."),this.pc.createAnswer().then(this.setLocalAndSendMessage,this.onCreateSessionDescriptionError)},handleIceCandidate:function(e){console.log("icecandidate event: ",e),e.candidate?this.sendMessage({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):console.log("End of candidates.")},handleRemoteStreamAdded:function(e){console.log("Remote stream added."),this.remoteStream=e.stream},handleRemoteStreamRemoved:function(e){console.log("Remote stream removed. Event: ",e)},setLocalAndSendMessage:function(e){this.pc.setLocalDescription(e),console.log("setLocalAndSendMessage sending message",e),this.sendMessage(e)},handleCreateOfferError:function(e){console.log("createOffer() error: ",e)},onCreateSessionDescriptionError:function(e){console.trace("Failed to create session description: "+e.toString())},handleRemoteHangup:function(){console.log("Session terminated."),this.stop()},stop:function(){this.isStarted=!1,this.pc.close(),this.pc=null},init:function(){navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(this.gotStream).catch(function(e){alert("getUserMedia() error: "+e.name)})}},mounted:function(){this.requestServers("https://3hs3ekzhqa.execute-api.us-east-1.amazonaws.com/prod/nat?sig=true"),this.room=prompt("Enter room name:"),this.$options.sockets.onopen=this.onOpen,this.$options.sockets.onclose=this.onClose,this.$options.sockets.onmessage=this.onMessage,this.$options.sockets.onerror=this.onError,this.init()}},p=h,m=o("2877"),f=Object(m["a"])(p,a,i,!1,null,null,null),g=f.exports,v={name:"app",components:{VideoFrame:g}},S=v,y=(o("034f"),Object(m["a"])(S,r,s,!1,null,null,null)),b=y.exports,C=o("b408"),R=o.n(C);n["a"].config.productionTip=!1,n["a"].use(R.a,"wss://gbgeujsgda.execute-api.us-east-1.amazonaws.com/test",{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:3e3}),new n["a"]({render:function(e){return e(b)}}).$mount("#app")},"64a9":function(e,t,o){}});
//# sourceMappingURL=app.aac1e71e.js.map