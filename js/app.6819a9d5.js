(function(e){function t(t){for(var o,s,i=t[0],c=t[1],l=t[2],u=0,h=[];u<i.length;u++)s=i[u],r[s]&&h.push(r[s][0]),r[s]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);d&&d(t);while(h.length)h.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],o=!0,i=1;i<n.length;i++){var c=n[i];0!==r[c]&&(o=!1)}o&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={app:0},a=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/cybrtc/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var d=c;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var o=n("64a9"),r=n.n(o);r.a},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var o=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("VideoFrame")],1)},a=[],s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"videos"}},[n("video",{attrs:{id:"localVideo",autoplay:"",muted:"",playsinline:""},domProps:{srcObject:e.localStream,muted:!0}}),n("video",{attrs:{id:"remoteVideo",autoplay:"",playsinline:""},domProps:{srcObject:e.remoteStream}})])},i=[],c=(n("7f7f"),n("6b54"),n("06db"),n("f499")),l=n.n(c),d=(n("f559"),n("5d73")),u=n.n(d),h=n("795b"),p=n.n(h),m=(n("96cf"),n("3b8d")),f={name:"VideoFrame",data:function(){return{room:void 0,isStarted:!1,isInitiator:!1,isChannelReady:!1,turnReady:!1,pc:void 0,pcConfig:{iceServers:[{urls:"stun:global.stun.twilio.com:3478?transport=udp"}]},localStream:void 0,remoteStream:void 0}},methods:{requestServers:function(){var e=Object(m["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new p.a(function(e,n){var o=this,r=!1,a=!0,s=!1,i=void 0;try{for(var c,l=u()(this.pcConfig.iceServers);!(a=(c=l.next()).done);a=!0){var d=c.value;if(d.urls.startsWith("turn:")){r=!0,this.turnReady=!0;break}}}catch(p){s=!0,i=p}finally{try{a||null==l.return||l.return()}finally{if(s)throw i}}if(!r){var h=new XMLHttpRequest;h.onreadystatechange=function(){if(4===h.readyState&&200===h.status){var t=JSON.parse(h.responseText),n=!0,r=!1,a=void 0;try{for(var s,i=u()(t.iceServers);!(n=(s=i.next()).done);n=!0){var c=s.value;c.url.startsWith("turn:")&&(console.log("Got TURN server: ",c.url),o.pcConfig.iceServers.push({urls:"turn:"+c.username+"@"+c.url,credential:c.credential}))}}catch(p){r=!0,a=p}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}o.turnReady=!0,e()}},h.onerror=function(){n({status:h.status,statusText:h.statusText})},h.open("GET",t,!0),h.send()}}.bind(this)));case 1:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),sendMessage:function(e){console.log("Client sending message: ",e),this.$socket.send(l()({action:"message",message:e,room:this.room}))},onOpen:function(){var e=Object(m["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("CONNECTED"),""!==this.room&&(this.$socket.send(l()({action:"create or join",room:this.room})),console.log("Attempted to create or join room",this.room)),e.next=4,this.requestServers("https://3hs3ekzhqa.execute-api.us-east-1.amazonaws.com/prod/nat?sig=true");case 4:return e.next=6,this.init();case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),onClose:function(){console.log("CLOSED")},onMessage:function(e){var t=JSON.parse(e.data);switch(t.action){case"created":var n=t.room;console.log("Created room "+n),this.isInitiator=!0;break;case"full":var o=t.room;alert("Room "+o+" is full");break;case"join":var r=t.room;console.log("Another peer made a request to join room "+r),console.log("This peer is the initiator of room "+r+"!"),this.isChannelReady=!0;break;case"joined":var a=t.room;console.log("joined: "+a),this.isChannelReady=!0,this.maybeStart();break;case"message":var s=t.message;if(console.log("Client received message:",s),"got user media"===s)this.maybeStart();else if("bye"===s&&this.isStarted)this.handleRemoteHangup();else switch(s.type){case"offer":this.isInitiator||this.isStarted||this.maybeStart(),this.pc.setRemoteDescription(new RTCSessionDescription(s)).then(this.doAnswer);break;case"answer":this.isStarted&&this.pc.setRemoteDescription(new RTCSessionDescription(s));break;case"candidate":if(this.isStarted){var i=new RTCIceCandidate({sdpMLineIndex:s.label,candidate:s.candidate});this.pc.addIceCandidate(i).then(function(e){console.log("adding ice candidate success")}).catch(function(e){return console.error(e.message)})}break}break}},onError:function(e){console.log("ERROR",e.data)},gotStream:function(e){console.log("Adding local stream."),this.localStream=e,this.sendMessage("got user media"),this.isInitiator&&this.maybeStart()},maybeStart:function(){console.log(">>>>>>> maybeStart() ",this.isStarted,this.localStream,this.isChannelReady),!this.isStarted&&void 0!==this.localStream&&this.isChannelReady?(console.log(">>>>>> creating peer connection"),this.createPeerConnection(),this.pc.addStream(this.localStream),this.isStarted=!0,console.log("isInitiator",this.isInitiator),this.isInitiator&&this.doCall()):(console.log("Started: ".concat(this.isStarted," channelReady: ").concat(this.isChannelReady," localStream: ").concat(this.localStream)),console.log("not start"))},createPeerConnection:function(){try{this.pc=new RTCPeerConnection(null),this.pc.onicecandidate=this.handleIceCandidate,this.pc.onaddstream=this.handleRemoteStreamAdded,this.pc.onremovestream=this.handleRemoteStreamRemoved,console.log("Created RTCPeerConnnection")}catch(e){console.log("Failed to create PeerConnection, exception: "+e.message),alert("Cannot create RTCPeerConnection object.")}},doCall:function(){console.log("Sending offer to peer"),this.pc.createOffer().then(this.setLocalAndSendMessage,this.handleCreateOfferError)},doAnswer:function(){console.log("Sending answer to peer."),this.pc.createAnswer().then(this.setLocalAndSendMessage,this.onCreateSessionDescriptionError)},handleIceCandidate:function(e){console.log("icecandidate event: ",e),e.candidate?this.sendMessage({type:"candidate",label:e.candidate.sdpMLineIndex,id:e.candidate.sdpMid,candidate:e.candidate.candidate}):console.log("End of candidates.")},handleRemoteStreamAdded:function(e){console.log("Remote stream added."),this.remoteStream=e.stream},handleRemoteStreamRemoved:function(e){console.log("Remote stream removed. Event: ",e)},setLocalAndSendMessage:function(e){this.pc.setLocalDescription(e),console.log("setLocalAndSendMessage sending message",e),this.sendMessage(e)},handleCreateOfferError:function(e){console.log("createOffer() error: ",e)},onCreateSessionDescriptionError:function(e){console.trace("Failed to create session description: "+e.toString())},handleRemoteHangup:function(){console.log("Session terminated."),this.stop()},stop:function(){this.isStarted=!1,this.pc.close(),this.pc=null},init:function(){var e=Object(m["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0,video:!0});case 3:t=e.sent,console.log(t),this.gotStream(t),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),alert("getUserMedia() error: "+e.t0.name);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));function t(){return e.apply(this,arguments)}return t}()},mounted:function(){var e=Object(m["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.room=prompt("Enter room name:"),this.$options.sockets.onopen=this.onOpen,this.$options.sockets.onclose=this.onClose,this.$options.sockets.onmessage=this.onMessage,this.$options.sockets.onerror=this.onError;case 5:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()},g=f,v=n("2877"),S=Object(v["a"])(g,s,i,!1,null,null,null),b=S.exports,y={name:"app",components:{VideoFrame:b}},R=y,w=(n("034f"),Object(v["a"])(R,r,a,!1,null,null,null)),C=w.exports,O=n("b408"),x=n.n(O);o["a"].config.productionTip=!1,o["a"].use(x.a,"wss://gbgeujsgda.execute-api.us-east-1.amazonaws.com/test",{reconnection:!0,reconnectionAttempts:5,reconnectionDelay:3e3}),new o["a"]({render:function(e){return e(C)}}).$mount("#app")},"64a9":function(e,t,n){}});
//# sourceMappingURL=app.6819a9d5.js.map